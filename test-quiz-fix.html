<!DOCTYPE html>
<html>
<head>
    <title>题目功能修复测试</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; }
        .test-section { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 4px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
        .quiz-section { 
            border: 2px solid #67c23a; 
            border-radius: 8px; 
            padding: 15px;
            margin: 15px 0;
            background: rgba(103, 194, 58, 0.05);
        }
        .question-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
            background: #f9f9f9;
        }
        .add-quiz-btn {
            padding: 12px 20px;
            background: linear-gradient(90deg, #67c23a 60%, #5daf34 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            box-shadow: 0 4px 12px rgba(103, 194, 58, 0.3);
        }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group textarea { min-height: 80px; resize: vertical; }
        .btn-group { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #409eff; color: #fff; }
        .btn-secondary { background: #6c757d; color: #fff; }
        .btn-success { background: #67c23a; color: #fff; }
        .btn-danger { background: #f56c6c; color: #fff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 题目功能修复测试</h1>
        
        <div class="test-section">
            <h2>测试说明</h2>
            <p>这个测试页面模拟了AdminPanel中的题目功能，用于验证修复是否有效。</p>
            <ul>
                <li>✅ 测试题目添加功能</li>
                <li>✅ 测试题目编辑功能</li>
                <li>✅ 测试题目删除功能</li>
                <li>✅ 测试正确答案设置</li>
                <li>✅ 测试状态管理</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h2>文章编辑表单</h2>
            <form id="articleForm">
                <div class="form-group">
                    <label>标题：</label>
                    <input type="text" id="title" value="" placeholder="请输入文章标题" />
                </div>
                
                <div class="form-group">
                    <label>分类：</label>
                    <select id="category">
                        <option value="安全规程">安全规程</option>
                        <option value="设备维护">设备维护</option>
                        <option value="应急处理">应急处理</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>要求阅读时间（分钟）：</label>
                    <input type="number" id="readingTime" value="30" min="1" max="120" />
                </div>
                
                <div class="form-group">
                    <label>内容：</label>
                    <textarea id="content" placeholder="请输入文章内容"></textarea>
                </div>
                
                <!-- 题目录入部分 -->
                <div class="quiz-section">
                    <h4 style="margin: '0 0 15px 0', fontSize: '16px', color: '#67c23a'">📝 考试题目</h4>
                    <p style="fontSize: '12px', opacity: 0.8, marginBottom: '15px'">
                        添加考试题目，用户阅读完成后将随机抽取5道题进行作答
                    </p>
                    
                    <div id="questions-container">
                        <!-- 题目将在这里动态添加 -->
                    </div>
                    
                    <div style="fontSize: '12px', opacity: 0.8, marginBottom: '15px', textAlign: 'center', padding: '8px', background: 'rgba(0,0,0,0.05)', borderRadius: '4px'">
                        当前题目数量: <span id="question-count">0</span> 道
                    </div>
                    
                    <button type="button" class="add-quiz-btn" onclick="addQuestion()">
                        ➕ 添加题目
                    </button>
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">重置</button>
                    <button type="submit" class="btn btn-primary">保存文章</button>
                </div>
            </form>
        </div>
        
        <div class="test-section">
            <h2>测试结果</h2>
            <div id="test-results">
                <p>点击"添加题目"按钮开始测试...</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>数据导出</h2>
            <pre id="data-export" style="background: #f8f8f8; padding: 10px; border-radius: 4px; overflow-x: auto;"></pre>
        </div>
    </div>
    
    <script>
        let editArticle = {
            id: '',
            title: '',
            category: '安全规程',
            content: '',
            requiredReadingTime: 30,
            questions: []
        };
        
        let testResults = [];
        
        function addTestResult(message, type = 'info') {
            testResults.push({ message, type, time: new Date().toLocaleTimeString() });
            updateTestResults();
        }
        
        function updateTestResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = testResults.map(result => 
                `<p class="${result.type}">[${result.time}] ${result.message}</p>`
            ).join('');
        }
        
        function updateDataExport() {
            document.getElementById('data-export').textContent = JSON.stringify(editArticle, null, 2);
        }
        
        function updateQuestionCount() {
            document.getElementById('question-count').textContent = editArticle.questions.length;
        }
        
        function addQuestion() {
            const newQuestion = {
                id: Date.now(),
                question: '',
                options: ['', '', '', ''],
                correctAnswer: 0
            };
            
            editArticle.questions.push(newQuestion);
            renderQuestions();
            updateQuestionCount();
            updateDataExport();
            addTestResult('✅ 添加题目成功', 'success');
        }
        
        function deleteQuestion(index) {
            editArticle.questions.splice(index, 1);
            renderQuestions();
            updateQuestionCount();
            updateDataExport();
            addTestResult(`✅ 删除题目 ${index + 1} 成功`, 'success');
        }
        
        function updateQuestion(index, field, value) {
            editArticle.questions[index][field] = value;
            updateDataExport();
            addTestResult(`✅ 更新题目 ${index + 1} 的 ${field}`, 'success');
        }
        
        function updateOption(questionIndex, optionIndex, value) {
            editArticle.questions[questionIndex].options[optionIndex] = value;
            updateDataExport();
            addTestResult(`✅ 更新题目 ${questionIndex + 1} 的选项 ${optionIndex + 1}`, 'success');
        }
        
        function setCorrectAnswer(questionIndex, optionIndex) {
            editArticle.questions[questionIndex].correctAnswer = optionIndex;
            renderQuestions();
            updateDataExport();
            addTestResult(`✅ 设置题目 ${questionIndex + 1} 的正确答案为选项 ${optionIndex + 1}`, 'success');
        }
        
        function renderQuestions() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';
            
            editArticle.questions.forEach((question, questionIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-item';
                questionDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <span style="font-size: 14px; font-weight: bold;">题目 ${questionIndex + 1}</span>
                        <button onclick="deleteQuestion(${questionIndex})" class="btn btn-danger" style="font-size: 12px;">
                            删除
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label>题目内容：</label>
                        <textarea
                            value="${question.question}"
                            onchange="updateQuestion(${questionIndex}, 'question', this.value)"
                            placeholder="请输入题目内容..."
                        ></textarea>
                    </div>
                    
                    <div style="margin-bottom: 8px;">
                        <label style="font-size: 12px; opacity: 0.8;">选项：</label>
                        ${question.options.map((option, optionIndex) => `
                            <div style="display: flex; align-items: center; margin-top: 6px;">
                                <span style="
                                    width: 20px; 
                                    height: 20px; 
                                    border-radius: 50%; 
                                    background: ${question.correctAnswer === optionIndex ? '#67c23a' : 'rgba(0,0,0,0.2)'};
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-size: 10px;
                                    margin-right: 8px;
                                    cursor: pointer;
                                    color: #fff;
                                " onclick="setCorrectAnswer(${questionIndex}, ${optionIndex})">
                                    ${question.correctAnswer === optionIndex ? '✓' : String.fromCharCode(65 + optionIndex)}
                                </span>
                                <input
                                    type="text"
                                    value="${option}"
                                    onchange="updateOption(${questionIndex}, ${optionIndex}, this.value)"
                                    placeholder="选项 ${String.fromCharCode(65 + optionIndex)}"
                                    style="flex: 1; padding: 6px 8px; border-radius: 4px; border: 1px solid #ddd;"
                                />
                            </div>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }
        
        function resetForm() {
            editArticle = {
                id: '',
                title: '',
                category: '安全规程',
                content: '',
                requiredReadingTime: 30,
                questions: []
            };
            
            document.getElementById('title').value = '';
            document.getElementById('category').value = '安全规程';
            document.getElementById('readingTime').value = '30';
            document.getElementById('content').value = '';
            
            renderQuestions();
            updateQuestionCount();
            updateDataExport();
            testResults = [];
            updateTestResults();
            addTestResult('🔄 表单已重置', 'warning');
        }
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            updateQuestionCount();
            updateDataExport();
            addTestResult('🚀 测试页面已加载', 'success');
        });
        
        // 表单提交
        document.getElementById('articleForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addTestResult('💾 文章保存成功！', 'success');
            addTestResult(`📊 文章信息: 标题="${editArticle.title}", 题目数量=${editArticle.questions.length}`, 'info');
        });
    </script>
</body>
</html> 