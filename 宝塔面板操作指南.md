# 宝塔面板问题解决指南

## 当前问题分析

从你的截图可以看到以下问题：
1. ❌ **项目依赖安装异常**：rollup 原生模块问题
2. ❌ **项目未启动**：依赖问题导致启动失败
3. ❌ **域名端口冲突**：116.62.65.246:8 已存在

## 解决方案

### 步骤1：修复依赖安装问题

**重要：不要在宝塔面板中直接安装依赖！**

#### 方法A：SSH 方式修复（推荐）

1. **通过 SSH 连接到服务器**
   ```bash
   ssh root@116.62.65.246
   ```

2. **执行修复命令**
   ```bash
   # 进入项目目录
   cd /www/wwwroot/116.62.65.246/learning-platform
   
   # 清理前端依赖（这是问题根源）
   rm -rf node_modules package-lock.json
   
   # 只安装和启动后端服务
   cd server
   rm -rf node_modules package-lock.json
   npm cache clean --force
   npm install --production
   
   # 直接启动后端服务
   node app.js
   ```

#### 方法B：宝塔终端方式

1. **在宝塔面板中打开终端**
   - 点击左侧菜单 "终端"
   - 或在项目管理中点击 "终端"

2. **执行相同的修复命令**（如上方法A中的命令）

### 步骤2：重新配置宝塔项目

#### 删除现有项目配置

1. **在宝塔面板中**：
   - 点击 Node.js 项目管理
   - 找到 `learning_platform` 项目
   - 点击 "删除" 按钮

#### 重新创建项目（重要配置）

1. **点击 "添加Node.js项目"**

2. **正确填写项目信息**：
   ```
   项目名称: learning-platform-server
   项目目录: /www/wwwroot/116.62.65.246/learning-platform/server
   启动文件: app.js
   端口: 3001
   ```

3. **不要勾选 "自动安装依赖"**

### 步骤3：解决域名冲突

#### 删除冲突的域名

1. **在宝塔面板中**：
   - 点击 "网站" 管理
   - 找到域名 `116.62.65.246:8`
   - 点击 "删除"

#### 重新配置网站

1. **添加网站**：
   ```
   域名: 116.62.65.246
   端口: 80 (或 443 for HTTPS)
   网站目录: /www/wwwroot/116.62.65.246/learning-platform/dist
   ```

2. **配置反向代理**：
   - 点击网站设置
   - 选择 "反向代理"
   - 添加代理规则：
     ```
     代理名称: api
     目标URL: http://127.0.0.1:3001
     发送域名: $host
     代理目录: /api/
     ```

### 步骤4：启动服务

#### 启动后端服务

1. **在宝塔 Node.js 项目管理中**：
   - 找到新创建的项目
   - 点击 "启动" 按钮

2. **或通过命令行启动**：
   ```bash
   cd /www/wwwroot/116.62.65.246/learning-platform/server
   pm2 start app.js --name learning-platform-server
   ```

#### 部署前端文件

**方案A：本地构建上传（推荐）**
1. 在本地执行 `npm run build`
2. 上传 `dist` 文件夹到服务器
3. 设置网站根目录为 `dist` 文件夹

**方案B：使用现有静态文件**
1. 创建简单的 `index.html`
2. 直接访问后端 API

## 完整操作流程

### 🔥 立即执行步骤

1. **SSH 连接服务器执行**：
   ```bash
   cd /www/wwwroot/116.62.65.246/learning-platform
   rm -rf node_modules package-lock.json
   cd server
   npm install --production
   pm2 start app.js --name learning-platform-server
   pm2 save
   ```

2. **在宝塔面板操作**：
   - 删除现有的 Node.js 项目
   - 删除冲突的域名配置
   - 重新添加项目（指向 server 目录）
   - 重新配置网站和域名

3. **验证部署**：
   ```bash
   # 检查服务状态
   pm2 status
   
   # 测试 API
   curl http://localhost:3001/
   ```

## 重要提醒

⚠️ **关键点**：
1. **不要**让宝塔安装前端依赖
2. **只运行**后端 Node.js 服务
3. **端口配置**：后端用 3001，前端用 80/443
4. **使用 PM2** 管理进程，不是 Node.js 项目管理

✅ **成功标志**：
- PM2 显示服务运行正常
- 能够访问 `http://116.62.65.246:3001/`
- 前端能正常访问（如果已部署）

如果按照以上步骤仍有问题，请告诉我具体的错误信息！
