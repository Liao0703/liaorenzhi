# 宝塔部署检查清单 - 47.109.142.72

## 🚨 当前问题
- 无法访问网页：http://47.109.142.72
- JavaScript MIME类型错误
- 页面空白或加载失败

## ✅ 部署检查清单

### 1. 服务器基础检查
- [ ] 服务器可以正常SSH连接
- [ ] 宝塔面板可以正常访问
- [ ] Node.js已安装（推荐版本：18.x或20.x）
- [ ] PM2已安装

### 2. 项目文件检查
- [ ] 项目已上传到：`/www/wwwroot/learning-platform`
- [ ] `dist`目录存在且包含前端文件
- [ ] `server-baota.js`文件存在
- [ ] `package.json`文件存在

### 3. 宝塔面板配置
- [ ] 已创建网站：域名为 `47.109.142.72`
- [ ] 网站根目录设置为：`/www/wwwroot/learning-platform/dist`
- [ ] PHP版本设置为"纯静态"或关闭PHP
- [ ] SSL证书状态（可选）

### 4. Nginx配置检查
- [ ] 复制了正确的Nginx配置
- [ ] server_name设置为 `47.109.142.72`
- [ ] 静态文件路径正确
- [ ] API代理配置正确（端口3001）

### 5. 后端服务检查
- [ ] 后端服务已启动：`pm2 start server-baota.js`
- [ ] PM2状态正常：`pm2 status`
- [ ] 端口3001未被占用
- [ ] 健康检查正常：`curl http://localhost:3001/health`

### 6. 防火墙和端口
- [ ] 端口80已开放（HTTP）
- [ ] 端口443已开放（HTTPS，如果使用SSL）
- [ ] 端口3001已开放（后端API）
- [ ] 宝塔安全组规则正确

### 7. 文件权限
- [ ] 项目目录权限：`chmod -R 755 /www/wwwroot/learning-platform`
- [ ] Nginx用户有读取权限
- [ ] 日志目录可写

## 🔧 快速修复命令

### 在服务器上执行：

```bash
# 1. 进入项目目录
cd /www/wwwroot/learning-platform

# 2. 检查文件是否存在
ls -la
ls -la dist/

# 3. 设置正确权限
chmod -R 755 .
chown -R www:www .

# 4. 停止旧服务
pm2 stop all
pm2 delete all

# 5. 启动新服务
pm2 start server-baota.js --name learning-platform
pm2 save
pm2 startup

# 6. 检查服务状态
pm2 status
pm2 logs learning-platform

# 7. 测试后端API
curl http://localhost:3001/health
curl http://localhost:3001/api/status

# 8. 测试前端访问
curl -I http://47.109.142.72
```

## 📋 Nginx配置模板

```nginx
server {
    listen 80;
    server_name 47.109.142.72;
    root /www/wwwroot/learning-platform/dist;
    index index.html;

    # 前端静态文件
    location / {
        try_files $uri $uri/ /index.html;
        
        # 修复JavaScript MIME类型
        location ~* \.js$ {
            add_header Content-Type "application/javascript; charset=UTF-8";
            add_header X-Content-Type-Options "nosniff";
            expires 1d;
        }
        
        location ~* \.css$ {
            add_header Content-Type "text/css; charset=UTF-8";
            expires 1d;
        }
    }

    # API代理到后端
    location /api/ {
        proxy_pass http://127.0.0.1:3001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 健康检查
    location /health {
        proxy_pass http://127.0.0.1:3001/health;
    }

    # favicon处理
    location /favicon.ico {
        return 204;
        access_log off;
    }

    # 日志
    access_log /www/wwwlogs/learning-platform.access.log;
    error_log /www/wwwlogs/learning-platform.error.log;
}
```

## 🔍 故障排查

### 1. 页面无法访问
```bash
# 检查Nginx状态
systemctl status nginx
nginx -t

# 检查端口监听
netstat -tlnp | grep :80
```

### 2. JavaScript错误
```bash
# 检查文件MIME类型
curl -I http://47.109.142.72/assets/index-xxx.js
```

### 3. API无法访问
```bash
# 检查后端服务
pm2 logs learning-platform
curl http://localhost:3001/health
```

### 4. 权限问题
```bash
# 检查文件权限
ls -la /www/wwwroot/learning-platform/dist/
```

## 📞 常见问题解决

### Q: 页面空白
A: 检查dist目录是否存在，index.html是否正确

### Q: JavaScript MIME错误
A: 确保Nginx配置中包含了正确的MIME类型设置

### Q: API请求失败
A: 检查后端服务是否启动，端口是否正确

### Q: 403 Forbidden
A: 检查文件权限和Nginx配置

## ✅ 部署成功标志

部署成功后，您应该能够：
1. ✅ 访问 http://47.109.142.72 看到登录页面
2. ✅ 没有JavaScript MIME类型错误
3. ✅ API接口正常响应
4. ✅ 可以正常登录和使用功能

## 📱 联系支持

如果问题仍未解决，请提供：
1. 宝塔面板截图
2. PM2状态：`pm2 status`
3. Nginx错误日志：`tail -f /www/wwwlogs/learning-platform.error.log`
4. 后端日志：`pm2 logs learning-platform`




