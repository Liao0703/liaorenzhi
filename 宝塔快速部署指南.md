# 宝塔快速部署指南 - 兴隆场车站班前学习监督系统

## 🚀 一键部署步骤

### 1. 准备工作

1. **上传文件到宝塔服务器**
   ```bash
   # 项目目录：/www/wwwroot/learning-platform
   ```

2. **确保Node.js版本**
   - 推荐：Node.js 18.x 或 20.x
   - 在宝塔面板 → 软件商店 → Node.js管理器中设置

### 2. 后端部署

1. **进入项目目录并安装依赖**
   ```bash
   cd /www/wwwroot/learning-platform
   cd server
   npm install --production
   ```

2. **配置环境变量**
   ```bash
   # 编辑 server/.env 文件
   NODE_ENV=production
   PORT=3001
   DB_HOST=localhost
   DB_USER=root
   DB_PASSWORD=你的数据库密码
   DB_NAME=learning_platform
   JWT_SECRET=your-secret-key-here
   ```

3. **启动后端服务**
   ```bash
   cd /www/wwwroot/learning-platform
   pm2 start ecosystem.config.js
   pm2 save
   pm2 startup
   ```

### 3. 前端部署

1. **构建前端（在本地或服务器）**
   ```bash
   # 如果在服务器上构建
   cd /www/wwwroot/learning-platform
   npm run build
   
   # 或者上传本地构建的 dist 目录
   ```

2. **在宝塔面板创建网站**
   - 网站 → 添加站点
   - 域名：你的IP或域名
   - 根目录：`/www/wwwroot/learning-platform/dist`

### 4. 配置Nginx

1. **复制配置内容**
   - 打开 `nginx-baota.conf` 文件
   - 复制全部内容

2. **在宝塔面板配置**
   - 网站 → 设置 → 配置文件
   - 替换原有配置
   - **记得修改 server_name 为你的实际域名或IP**

### 5. 验证部署

1. **检查后端服务**
   ```bash
   pm2 status
   curl http://localhost:3001/health
   ```

2. **访问网站**
   - 打开浏览器访问你的域名或IP
   - 应该能看到登录页面

## 🔧 常见问题解决

### 问题1：JavaScript MIME类型错误
**解决**：确保Nginx配置中包含了正确的MIME类型设置（已在nginx-baota.conf中配置）

### 问题2：API请求失败
**检查**：
```bash
# 检查后端服务状态
pm2 logs learning-platform-server

# 测试API连接
curl http://localhost:3001/api/status
```

### 问题3：静态文件404
**解决**：确保dist目录权限正确
```bash
chmod -R 755 /www/wwwroot/learning-platform/dist
```

### 问题4：数据库连接失败
**检查**：
- 数据库服务是否启动
- `.env` 文件中的数据库配置是否正确
- 数据库用户权限是否充足

## 📋 部署检查清单

- [ ] Node.js版本正确（18.x或20.x）
- [ ] 后端依赖安装完成
- [ ] 环境变量配置正确
- [ ] PM2服务启动成功
- [ ] 前端文件构建完成
- [ ] Nginx配置更新
- [ ] 域名/IP设置正确
- [ ] 数据库连接正常
- [ ] 防火墙端口开放（80, 3001）

## 🚨 紧急修复命令

如果部署失败，执行以下命令：

```bash
# 重启所有服务
pm2 restart all
systemctl restart nginx

# 查看错误日志
pm2 logs learning-platform-server
tail -f /www/wwwlogs/learning-platform.error.log

# 重新安装依赖
cd /www/wwwroot/learning-platform/server
rm -rf node_modules package-lock.json
npm install --production
```

## 🎯 成功标志

部署成功后，你应该能够：
1. 访问网站首页
2. 看到登录界面
3. API接口正常响应
4. 没有JavaScript或MIME类型错误

## 📞 技术支持

如果遇到问题，请提供：
1. 错误截图
2. PM2状态：`pm2 status`
3. 错误日志：`pm2 logs learning-platform-server`
4. Nginx错误日志：`tail -f /www/wwwlogs/learning-platform.error.log`
