# 本地开发环境启动指南

## 访问地址

### 开发模式（推荐）
- **前端地址**: http://localhost:5173
- **后端API**: http://localhost:3002
- **API文档**: http://localhost:3002/api-docs

### 生产模式预览
- **统一地址**: http://localhost:3002 （前后端都从这里访问）

## 快速启动方法

### 方法1：开发模式（推荐用于日常开发）

打开两个终端窗口：

**终端1 - 启动前端**
```bash
# 安装依赖（首次运行）
npm install

# 启动前端开发服务器
npm run dev
```
访问: http://localhost:5173

**终端2 - 启动后端**
```bash
# 启动后端服务器
npm run start
# 或者使用 nodemon 热重载
npm run server:dev
```
API地址: http://localhost:3002

### 方法2：一键启动脚本

创建并运行启动脚本：
```bash
# 创建启动脚本
chmod +x start-dev.sh

# 运行脚本
./start-dev.sh
```

### 方法3：使用 PM2（类似生产环境）

```bash
# 安装 PM2（如果还没安装）
npm install -g pm2

# 使用本地配置启动
pm2 start ecosystem.local.config.js

# 查看运行状态
pm2 status

# 查看日志
pm2 logs

# 停止所有服务
pm2 stop all
```

## 环境配置

### 1. 创建本地环境变量文件

创建 `.env` 文件（如果不存在）：
```bash
cp env.example .env
```

修改 `.env` 中的配置：
```env
# 本地数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=你的本地MySQL密码
DB_NAME=learning_platform

# API配置
PORT=3002
NODE_ENV=development

# 允许本地跨域
CORS_ORIGIN=http://localhost:5173
```

### 2. 设置本地数据库

```bash
# 登录MySQL
mysql -u root -p

# 创建数据库
CREATE DATABASE IF NOT EXISTS learning_platform 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;

# 导入数据库结构（如果有SQL文件）
mysql -u root -p learning_platform < create-users-table.sql
```

## 常用开发命令

```bash
# 前端开发（带热重载）
npm run dev

# 后端开发（带热重载）
npm run server:dev

# 构建前端
npm run build

# 预览构建结果
npm run preview

# 运行测试
npm test

# 检查代码规范
npm run lint
```

## 访问不同功能

### 主要页面
- 首页: http://localhost:5173/
- 登录: http://localhost:5173/login
- 管理员: http://localhost:5173/admin
- 维护人员: http://localhost:5173/maintenance

### API 端点测试
- 健康检查: http://localhost:3002/api/health
- 用户列表: http://localhost:3002/api/users
- API文档: http://localhost:3002/api-docs

## 常见问题

### 1. 端口被占用
```bash
# 查看占用端口的进程
lsof -i :5173  # 前端端口
lsof -i :3002  # 后端端口

# 杀掉占用的进程
kill -9 <PID>
```

### 2. 数据库连接失败
- 确认 MySQL 服务已启动
- 检查 `.env` 中的数据库配置
- 确认数据库用户权限

### 3. 前端无法访问后端API
- 检查后端是否正常运行
- 确认 CORS 配置正确
- 查看浏览器控制台错误信息

### 4. 修改默认端口
如果默认端口被占用，可以修改：

**前端端口**（vite.config.ts）:
```javascript
export default defineConfig({
  server: {
    port: 3000  // 改为其他端口
  }
})
```

**后端端口**（.env）:
```env
PORT=3003  # 改为其他端口
```

## 开发建议

1. **使用开发模式**：日常开发使用 `npm run dev`，支持热重载
2. **查看日志**：开发时打开浏览器控制台查看前端日志，终端查看后端日志
3. **使用调试工具**：VS Code 的调试功能、Chrome DevTools
4. **定期测试**：每完成一个功能就在本地测试，确保正常后再部署

## 部署前检查

在部署到服务器前，确保：
1. ✅ 所有功能在本地测试通过
2. ✅ 数据库迁移脚本准备好
3. ✅ 环境变量配置正确
4. ✅ 构建无错误
5. ✅ 没有调试代码和 console.log

---

💡 **提示**: 始终先在本地测试，成功后再部署到服务器！
