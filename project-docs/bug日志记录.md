# Bug日志记录

## 2025-01-11 宝塔面板和网站404错误

### 问题描述
- **时间**: 2025-01-11
- **报告人**: 用户
- **症状**: 
  - 宝塔面板访问404 (http://47.109.142.72:8888)
  - 网站无法访问
- **影响范围**: 
  - 宝塔面板管理界面不可用
  - 整个网站服务不可用

### 可能原因分析
1. **Nginx配置问题**
   - 网站根目录配置错误（可能被误设为php-backend目录）
   - Nginx配置文件语法错误
   - Location规则配置不当

2. **服务状态问题**
   - Nginx服务可能停止或崩溃
   - Node.js后端服务未运行
   - 宝塔面板服务异常

3. **文件系统问题**
   - 前端dist目录可能丢失
   - 文件权限被修改
   - 关键文件被误删

### 诊断步骤
1. 检查Nginx服务状态
2. 验证配置文件语法
3. 确认项目文件完整性
4. 检查端口监听状态
5. 查看错误日志

### 解决方案
1. **宝塔面板修复脚本**: `fix-baota-panel-404.sh`
   - 检查宝塔服务状态
   - 自动重启宝塔面板
   - 检查端口和防火墙
   - 获取面板访问信息
   - 提供重装建议

2. **网站404诊断脚本**: `fix-baota-404.sh`
   - 自动检查服务状态
   - 验证配置问题
   - 生成修复建议

3. **Nginx快速修复脚本**: `quick-fix-nginx-404.sh`
   - 备份当前配置
   - 自动修复Nginx配置
   - 重启相关服务
   - 创建临时维护页面

4. **详细文档**:
   - `宝塔面板访问故障解决方案.md` - 面板404专门解决方案
   - `宝塔404错误修复指南.md` - 网站404修复步骤
   - 包含手动修复步骤、常见问题解决、预防措施

### 根本原因（待确认）
需要登录服务器后确认具体原因：
- [ ] 宝塔面板服务是否崩溃
- [ ] 端口是否被修改或占用
- [ ] 是否启用了安全入口限制
- [ ] 防火墙或安全组规则是否变更
- [ ] 检查最近的配置更改记录
- [ ] 查看系统日志确认服务崩溃原因
- [ ] 验证是否有自动更新导致配置被覆盖

### 预防措施
1. 定期备份Nginx配置文件
2. 设置服务监控和自动重启
3. 避免直接在生产环境修改配置
4. 保持配置文档更新

### 状态
- **当前状态**: 已提供完整修复方案，等待执行
- **下一步**: 
  1. SSH登录服务器执行 `fix-baota-panel-404.sh` 修复面板
  2. 执行 `quick-fix-nginx-404.sh` 修复网站
  3. 检查阿里云安全组8888端口是否开放
  4. 如无法SSH登录，使用阿里云VNC控制台

---

## 历史问题记录

### 2025-01-10 文件上传编码问题
- **问题**: 上传的文章内容显示乱码
- **原因**: 数据库字符集设置不正确
- **解决**: 修改为utf8mb4字符集

### 2025-01-09 登录500错误
- **问题**: 用户登录时返回500错误
- **原因**: 数据库连接配置错误
- **解决**: 更新.env文件数据库配置

### 2025-01-08 CORS跨域问题
- **问题**: 前端无法调用API
- **原因**: CORS头部设置缺失
- **解决**: 在Nginx配置中添加CORS头部
