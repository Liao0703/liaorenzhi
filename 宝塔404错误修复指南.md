# 🚨 宝塔404错误紧急修复指南

## 问题描述
宝塔面板或网站突然出现404错误，无法正常访问

## 🔍 常见404错误原因

1. **Nginx配置错误**
   - 网站根目录设置错误
   - location配置不正确
   - 配置文件语法错误

2. **服务未启动**
   - Nginx服务停止
   - Node.js后端服务停止
   - PHP-FPM服务停止

3. **文件缺失**
   - 前端dist目录不存在
   - index.html文件缺失
   - 静态资源文件丢失

4. **权限问题**
   - 文件权限设置错误
   - 目录无法访问

## ✅ 快速修复步骤

### 第一步：登录服务器检查服务状态

```bash
# SSH登录服务器
ssh root@47.109.142.72

# 检查Nginx状态
systemctl status nginx

# 如果Nginx未运行，启动它
systemctl start nginx

# 检查配置是否有错误
nginx -t
```

### 第二步：检查宝塔面板

```bash
# 检查宝塔面板状态
/etc/init.d/bt status

# 如果未运行，重启宝塔
/etc/init.d/bt restart

# 获取宝塔面板信息
bt default
```

### 第三步：检查网站配置

1. **登录宝塔面板**
   - 访问: http://47.109.142.72:8888
   - 使用管理员账号登录

2. **检查网站设置**
   - 进入【网站】菜单
   - 找到 47.109.142.72 网站
   - 点击【设置】

3. **修正网站根目录**
   ```
   正确设置: /www/wwwroot/learning-platform
   错误设置: /www/wwwroot/learning-platform/php-backend (不要这样设置)
   ```

4. **运行目录设置**
   - 保持为: / (根目录)
   - 不要设置为其他目录

### 第四步：修复Nginx配置

在宝塔面板 → 网站 → 配置文件，使用以下配置：

```nginx
server {
    listen 80;
    server_name 47.109.142.72;
    root /www/wwwroot/learning-platform;
    index index.html;
    
    # 错误日志
    error_log /www/wwwlogs/learning-platform.error.log;
    access_log /www/wwwlogs/learning-platform.access.log;

    # 前端静态文件
    location / {
        root /www/wwwroot/learning-platform/dist;
        try_files $uri $uri/ /index.html;
        
        # 修复MIME类型
        location ~* \.js$ {
            add_header Content-Type "text/javascript; charset=UTF-8";
        }
        location ~* \.css$ {
            add_header Content-Type "text/css; charset=UTF-8";
        }
    }

    # API代理
    location ^~ /api/ {
        proxy_pass http://127.0.0.1:3001;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 健康检查
    location /health {
        proxy_pass http://127.0.0.1:3001/health;
    }

    # 安全设置
    location ~ /\. {
        deny all;
    }
}
```

### 第五步：检查文件是否存在

```bash
# 检查项目目录
ls -la /www/wwwroot/learning-platform/

# 检查前端文件
ls -la /www/wwwroot/learning-platform/dist/

# 如果dist目录不存在，需要上传或构建
# 从本地上传dist目录到服务器
```

### 第六步：启动后端服务

```bash
# 进入后端目录
cd /www/wwwroot/learning-platform/server

# 检查是否有node_modules
if [ ! -d "node_modules" ]; then
    npm install
fi

# 使用PM2启动
pm2 start app.js --name learning-platform
pm2 save
pm2 startup

# 或者使用nohup启动
nohup node app.js > /var/log/learning-platform.log 2>&1 &
```

### 第七步：设置正确权限

```bash
# 设置文件权限
chown -R www:www /www/wwwroot/learning-platform
chmod -R 755 /www/wwwroot/learning-platform
chmod -R 777 /www/wwwroot/learning-platform/server/uploads
```

### 第八步：重启服务

```bash
# 重载Nginx配置
nginx -s reload

# 或在宝塔面板中
# 网站 → 47.109.142.72 → 重载
```

## 🔧 使用诊断脚本

我已经创建了自动诊断脚本，可以在服务器上运行：

```bash
# 上传并运行诊断脚本
bash fix-baota-404.sh
```

## 📝 检查清单

- [ ] Nginx服务正在运行
- [ ] 宝塔面板可以访问
- [ ] 网站根目录设置正确：/www/wwwroot/learning-platform
- [ ] dist目录存在且包含index.html
- [ ] Node.js后端服务正在3001端口运行
- [ ] Nginx配置文件语法正确
- [ ] 文件权限设置正确
- [ ] 防火墙允许80端口访问

## 🚨 如果还是404

### 查看错误日志

```bash
# Nginx错误日志
tail -f /www/wwwlogs/learning-platform.error.log

# 系统日志
journalctl -u nginx -n 50

# 访问日志
tail -f /www/wwwlogs/learning-platform.access.log
```

### 常见错误信息解决

1. **"No such file or directory"**
   - 检查文件路径是否正确
   - 确认文件是否存在

2. **"Permission denied"**
   - 运行: chown -R www:www /www/wwwroot/learning-platform

3. **"upstream timed out"**
   - 后端服务未启动
   - 启动Node.js服务

4. **"connect() failed"**
   - 后端端口错误
   - 检查是3001还是3002端口

## 💡 预防措施

1. **定期备份配置**
   ```bash
   cp /www/server/panel/vhost/nginx/*.conf /root/nginx-backup/
   ```

2. **监控服务状态**
   - 在宝塔面板设置监控
   - 设置服务自动重启

3. **保持文档更新**
   - 记录每次配置更改
   - 保存正确的配置模板

## 📞 紧急联系

如果问题无法解决：
1. 检查宝塔论坛相关问题
2. 查看服务器提供商的状态页
3. 联系技术支持

---

**最后更新时间**: 2025-01-11
**适用版本**: 宝塔面板 7.x, Nginx 1.x





