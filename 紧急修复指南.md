# ðŸš¨ ç´§æ€¥ä¿®å¤æŒ‡å— - JavaScript MIMEç±»åž‹é”™è¯¯

## ðŸ” é—®é¢˜åˆ†æž

ä»Žé”™è¯¯ä¿¡æ¯å¯ä»¥çœ‹å‡ºï¼ŒæœåŠ¡å™¨è¿”å›žäº† `application/octet-stream` è€Œä¸æ˜¯æ­£ç¡®çš„ `text/javascript`ï¼Œè¿™å¯¼è‡´æµè§ˆå™¨æ— æ³•åŠ è½½JavaScriptæ¨¡å—ã€‚

---

## âš¡ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šç¡®è®¤å½“å‰éƒ¨ç½²çŠ¶æ€

**è¯·åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š**

```bash
# 1. æ£€æŸ¥å½“å‰ç›®å½•ç»“æž„
cd /www/wwwroot/learning-platform
pwd
ls -la

# 2. æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la dist/
ls -la dist/assets/

# 3. æ£€æŸ¥Nginxé…ç½®
nginx -t

# 4. æ£€æŸ¥Node.jsè¿›ç¨‹
ps aux | grep node
netstat -tlnp | grep 3001
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å®å¡”é¢æ¿é…ç½®

**åœ¨å®å¡”é¢æ¿ä¸­æ£€æŸ¥ï¼š**

1. **ç½‘ç«™è®¾ç½®**
   - è¿›å…¥ ç½‘ç«™ â†’ 47.109.142.72 â†’ è®¾ç½®
   - æŸ¥çœ‹ "ç½‘ç«™ç›®å½•" è®¾ç½®
   - æŸ¥çœ‹ "è¿è¡Œç›®å½•" è®¾ç½®

2. **åå‘ä»£ç†è®¾ç½®**
   - æ£€æŸ¥æ˜¯å¦æœ‰é…ç½®åå‘ä»£ç†åˆ° 3001 ç«¯å£

---

## ðŸ› ï¸ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®å¤Nginxé…ç½®ï¼ˆæŽ¨èï¼‰

**åˆ›å»ºæ­£ç¡®çš„Nginxé…ç½®ï¼š**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cat > /tmp/nginx_fix.conf << 'EOF'
server {
    listen 80;
    server_name 47.109.142.72;
    root /www/wwwroot/learning-platform/dist;
    index index.html;

    # ä¿®å¤MIMEç±»åž‹é—®é¢˜
    location / {
        try_files $uri $uri/ /index.html;
        
        # JavaScriptæ¨¡å—
        location ~* \.(js|mjs)$ {
            add_header Content-Type "text/javascript; charset=UTF-8";
            add_header Cache-Control "no-cache";
            expires off;
        }
        
        # CSSæ–‡ä»¶
        location ~* \.css$ {
            add_header Content-Type "text/css; charset=UTF-8";
            add_header Cache-Control "no-cache";
            expires off;
        }
        
        # HTMLæ–‡ä»¶
        location ~* \.html$ {
            add_header Content-Type "text/html; charset=UTF-8";
            add_header Cache-Control "no-cache";
            expires off;
        }
    }

    # APIä»£ç†åˆ°Node.jsåŽç«¯
    location ^~ /api/ {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 30s;
        proxy_send_timeout 30s;
        proxy_read_timeout 30s;
    }

    # å¥åº·æ£€æŸ¥
    location = /health {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
    }

    # APIæ–‡æ¡£
    location ^~ /api-docs {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
    }

    # ç¦ç”¨ç¼“å­˜ï¼ˆè°ƒè¯•ç”¨ï¼‰
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";

    # é”™è¯¯æ—¥å¿—
    error_log /www/wwwlogs/learning-platform.error.log;
    access_log /www/wwwlogs/learning-platform.access.log;
}
EOF

# å¤‡ä»½å½“å‰é…ç½®
cp /www/server/panel/vhost/nginx/47.109.142.72.conf /www/server/panel/vhost/nginx/47.109.142.72.conf.backup

# åº”ç”¨æ–°é…ç½®
cp /tmp/nginx_fix.conf /www/server/panel/vhost/nginx/47.109.142.72.conf

# æµ‹è¯•å¹¶é‡è½½Nginx
nginx -t && nginx -s reload

echo "âœ… Nginxé…ç½®å·²æ›´æ–°ï¼"
```

### æ–¹æ¡ˆ2ï¼šé€šè¿‡å®å¡”é¢æ¿ä¿®å¤

**åœ¨å®å¡”é¢æ¿æ“ä½œï¼š**

1. **è¿›å…¥ç½‘ç«™è®¾ç½® â†’ é…ç½®æ–‡ä»¶**
2. **å®Œå…¨æ›¿æ¢é…ç½®å†…å®¹ä¸ºï¼š**

```nginx
server {
    listen 80;
    server_name 47.109.142.72;
    root /www/wwwroot/learning-platform/dist;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
        
        location ~* \.(js|mjs)$ {
            add_header Content-Type "text/javascript; charset=UTF-8";
            expires off;
        }
        
        location ~* \.css$ {
            add_header Content-Type "text/css; charset=UTF-8";
            expires off;
        }
    }

    location ^~ /api/ {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location = /health {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
    }

    error_log /www/wwwlogs/learning-platform.error.log;
    access_log /www/wwwlogs/learning-platform.access.log;
}
```

3. **ä¿å­˜é…ç½®**
4. **é‡è½½é…ç½®**

---

## ðŸ”§ æ–¹æ¡ˆ3ï¼šä¸´æ—¶è§£å†³æ–¹æ¡ˆ

**å¦‚æžœä¸Šè¿°æ–¹æ¡ˆä¸èµ·ä½œç”¨ï¼Œä½¿ç”¨ç›´æŽ¥è®¿é—®ï¼š**

```bash
# å¯åŠ¨Node.jsæœåŠ¡å™¨ï¼ˆå¦‚æžœæ²¡æœ‰è¿è¡Œï¼‰
cd /www/wwwroot/learning-platform
node server/app.js &

# æˆ–ä½¿ç”¨PM2
pm2 start ecosystem.config.js

# ç„¶åŽç›´æŽ¥è®¿é—®Node.jsæœåŠ¡å™¨
# http://47.109.142.72:3001
```

---

## âš¡ æœ€å¿«çš„ä¿®å¤å‘½ä»¤

**å¦‚æžœä½ åªæƒ³å¿«é€Ÿä¿®å¤ï¼Œç›´æŽ¥è¿è¡Œï¼š**

```bash
# ä¸€é”®ä¿®å¤è„šæœ¬
cd /www/wwwroot/learning-platform

# åˆ›å»ºä¸´æ—¶ä¿®å¤é…ç½®
cat > /tmp/quick_fix.conf << 'EOF'
server {
    listen 80;
    server_name 47.109.142.72;
    root /www/wwwroot/learning-platform/dist;
    index index.html;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location ~* \.(js|mjs)$ {
        add_header Content-Type "text/javascript; charset=UTF-8";
    }
    
    location ^~ /api/ {
        proxy_pass http://127.0.0.1:3001;
        proxy_set_header Host $host;
    }
}
EOF

# åº”ç”¨é…ç½®
cp /tmp/quick_fix.conf /www/server/panel/vhost/nginx/47.109.142.72.conf
nginx -s reload

echo "ðŸŽ‰ å¿«é€Ÿä¿®å¤å®Œæˆï¼åˆ·æ–°æµè§ˆå™¨è¯•è¯•ï¼š"
echo "http://47.109.142.72"
```

---

## ðŸ“‹ éªŒè¯ä¿®å¤

ä¿®å¤åŽï¼Œè®¿é—®ä»¥ä¸‹URLéªŒè¯ï¼š

1. **å‰ç«¯é¡µé¢**: http://47.109.142.72
   - åº”è¯¥ä¸å†æœ‰JavaScripté”™è¯¯
   
2. **APIå¥åº·æ£€æŸ¥**: http://47.109.142.72/health
   - åº”è¯¥è¿”å›žJSONå“åº”

3. **æ£€æŸ¥æ–‡ä»¶MIMEç±»åž‹**:
   ```bash
   curl -I http://47.109.142.72/assets/index-xxx.js
   # åº”è¯¥çœ‹åˆ°: Content-Type: text/javascript
   ```

---

## ðŸš¨ å¦‚æžœè¿˜ä¸è¡Œ

**è¯·è¿è¡Œè¯Šæ–­å‘½ä»¤å¹¶å‘Šè¯‰æˆ‘ç»“æžœï¼š**

```bash
# æ£€æŸ¥æ–‡ä»¶ç»“æž„
ls -la /www/wwwroot/learning-platform/dist/assets/

# æ£€æŸ¥Nginxé…ç½®
cat /www/server/panel/vhost/nginx/47.109.142.72.conf

# æ£€æŸ¥é”™è¯¯æ—¥å¿—
tail -f /www/wwwlogs/learning-platform.error.log
```

**ç«‹å³é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆæ‰§è¡Œï¼Œç„¶åŽå‘Šè¯‰æˆ‘ç»“æžœï¼** ðŸš€
