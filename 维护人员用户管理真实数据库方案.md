# 维护人员用户管理 - 真实数据库连接方案

## 📋 概述

本方案实现了维护人员管理页面直接连接阿里云RDS数据库，实时显示和操作真实的用户数据，而不是使用模拟数据。

## ✅ 已实现功能

### 1. 用户管理核心功能
- **查看用户列表** - 实时显示数据库中的所有用户
- **添加新用户** - 创建新的用户账号
- **编辑用户信息** - 修改现有用户的资料
- **删除用户** - 从数据库中删除用户
- **密码重置** - 为用户重置登录密码
- **角色管理** - 设置用户角色（管理员/维护人员/普通用户）

### 2. 高级功能
- **搜索过滤** - 按用户名、姓名、工号等搜索
- **统计信息** - 显示各类用户数量统计
- **实时连接状态** - 显示数据库连接状态
- **自动刷新** - 每30秒自动刷新数据

### 3. 数据字段
- 基本信息：用户名、密码、姓名
- 角色权限：admin（管理员）、maintenance（维护人员）、user（普通用户）
- 工作信息：工号、部门、班组、工种
- 联系方式：邮箱、电话
- 时间记录：注册时间

## 🚀 使用方法

### 方法一：独立页面访问（推荐）

1. **访问页面**
   ```
   http://你的域名/maintenance-users-real.html
   ```

2. **登录验证**
   - 页面会自动检查登录状态
   - 如未登录会跳转到登录页面

3. **使用功能**
   - 所有操作直接作用于真实数据库
   - 修改立即生效

### 方法二：集成到现有系统

1. **在维护管理面板添加入口**
   ```javascript
   // 在维护人员管理页面添加按钮
   <button onclick="window.open('/maintenance-users-real.html')">
     真实数据库管理
   </button>
   ```

2. **或直接替换现有页面**
   - 将现有的用户管理组件替换为此页面

### 方法三：通过API直接操作

使用系统提供的API端点：
- GET `/api/users` - 获取所有用户
- POST `/api/users` - 创建新用户
- PUT `/api/users/:id` - 更新用户
- DELETE `/api/users/:id` - 删除用户

## 🔧 配置说明

### 1. 数据库连接配置

在 `server/.env` 文件中配置：
```env
# 阿里云RDS配置
DB_HOST=rm-cn-7js4el1by00015fo.rwlb.cn-chengdu.rds.aliyuncs.com
DB_PORT=3306
DB_USER=admin123
DB_PASSWORD=Liao0820
DB_NAME=learning_platform
```

### 2. 确保真实数据库连接

运行配置脚本：
```bash
# 设置真实数据库连接
./setup-real-database.sh

# 或手动测试连接
node test-real-db.js
```

### 3. API服务器配置

确保后端服务正确连接数据库：
```javascript
// server/config/database.js
const dbConfig = {
  host: process.env.DB_HOST || 'rm-cn-7js4el1by00015fo.rwlb.cn-chengdu.rds.aliyuncs.com',
  port: process.env.DB_PORT || 3306,
  user: process.env.DB_USER || 'admin123',
  password: process.env.DB_PASSWORD || 'Liao0820',
  database: process.env.DB_NAME || 'learning_platform'
};
```

## 📊 数据库表结构

```sql
CREATE TABLE users (
  id INT PRIMARY KEY AUTO_INCREMENT,
  username VARCHAR(50) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(100),
  full_name VARCHAR(100),
  role VARCHAR(20) DEFAULT 'user',
  employee_id VARCHAR(50),
  company VARCHAR(100),
  department VARCHAR(100),
  team VARCHAR(100),
  job_type VARCHAR(100),
  email VARCHAR(100),
  phone VARCHAR(20),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 🔒 安全措施

1. **身份验证**
   - 所有API请求需要JWT token
   - 未登录用户无法访问

2. **权限控制**
   - 只有维护人员和管理员可以管理用户
   - 普通用户无法访问此页面

3. **密码安全**
   - 密码使用bcrypt加密存储
   - 重置密码需要确认

4. **数据验证**
   - 前端和后端双重验证
   - 防止SQL注入

## 🐛 常见问题

### 问题1：显示的还是模拟数据
**原因**：后端使用了内存数据库而非真实数据库
**解决**：
1. 检查 `server/.env` 配置
2. 确保数据库连接正常
3. 重启后端服务

### 问题2：无法连接数据库
**原因**：网络或配置问题
**解决**：
1. 检查服务器是否在RDS白名单中
2. 验证数据库账号密码
3. 测试网络连接

### 问题3：操作没有生效
**原因**：可能是缓存问题
**解决**：
1. 刷新页面
2. 清除浏览器缓存
3. 检查控制台错误信息

## 📝 操作日志

所有用户管理操作都会记录在：
1. 数据库的 `updated_at` 字段
2. 服务器日志文件
3. 浏览器控制台（开发模式）

## 🔄 数据同步

### 与其他系统同步
- 用户数据实时同步到所有连接的客户端
- 修改立即在数据库生效
- 其他系统通过API获取最新数据

### 备份建议
```bash
# 定期备份用户数据
mysqldump -h [RDS地址] -u admin123 -p learning_platform users > users_backup.sql
```

## 📞 技术支持

如遇到问题：
1. 查看浏览器控制台错误信息
2. 检查服务器日志：`/var/log/learning-platform.log`
3. 运行诊断脚本：`./check-and-fix-rds-access.sh`
4. 查看项目文档：`project-docs/`

## 更新记录

- **2024-01-XX** - 创建真实数据库连接方案
- **2024-01-XX** - 实现完整的用户管理功能
- **2024-01-XX** - 添加搜索和统计功能
- **2024-01-XX** - 优化界面和用户体验
