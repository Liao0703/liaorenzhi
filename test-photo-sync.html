<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç…§ç‰‡è¯†åˆ«åŠŸèƒ½åŒæ­¥æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ“· ç…§ç‰‡è¯†åˆ«åŠŸèƒ½åŒæ­¥æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸŒ æœåŠ¡å™¨è¿æ¥æµ‹è¯•</h2>
        <div id="server-status" class="status info">æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...</div>
        <button onclick="checkServerStatus()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“¦ åŠŸèƒ½æ¨¡å—æµ‹è¯•</h2>
        <div id="module-status" class="status info">æ­£åœ¨æ£€æŸ¥åŠŸèƒ½æ¨¡å—...</div>
        <button onclick="checkModules()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ API æ¥å£æµ‹è¯•</h2>
        <div id="api-status" class="status info">æ­£åœ¨æ£€æŸ¥APIæ¥å£...</div>
        <button onclick="checkAPIs()">é‡æ–°æ£€æŸ¥</button>
    </div>

    <div class="test-section">
        <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <div id="test-log" class="log"></div>
        <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    </div>

    <div class="test-section">
        <h2>ğŸ¯ å¿«é€Ÿè®¿é—®</h2>
        <a href="http://116.62.65.246:3000/" target="_blank">
            <button>è®¿é—®ä¸»é¡µé¢</button>
        </a>
        <a href="http://116.62.65.246:3000/camera-test" target="_blank">
            <button>è®¿é—®æ‘„åƒå¤´æµ‹è¯•</button>
        </a>
        <a href="http://116.62.65.246:3000/health" target="_blank">
            <button>å¥åº·æ£€æŸ¥</button>
        </a>
    </div>

    <script>
        const SERVER_URL = 'http://116.62.65.246:3000';
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            testResults.push({ message: logEntry, type });
            
            const logElement = document.getElementById('test-log');
            logElement.innerHTML = testResults.map(result => 
                `<div style="color: ${result.type === 'error' ? 'red' : result.type === 'success' ? 'green' : 'blue'}">${result.message}</div>`
            ).join('');
            logElement.scrollTop = logElement.scrollHeight;
        }

        function clearLog() {
            testResults = [];
            document.getElementById('test-log').innerHTML = '';
        }

        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        async function checkServerStatus() {
            log('å¼€å§‹æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...');
            updateStatus('server-status', 'æ­£åœ¨æ£€æŸ¥...', 'info');

            try {
                // æ£€æŸ¥å¥åº·çŠ¶æ€
                log('ğŸ” æ­£åœ¨æ£€æŸ¥å¥åº·çŠ¶æ€...');
                const healthResponse = await fetch(`${SERVER_URL}/health`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`ğŸ“Š å¥åº·æ£€æŸ¥å“åº”çŠ¶æ€: ${healthResponse.status} ${healthResponse.statusText}`);
                
                if (healthResponse.ok) {
                    const healthData = await healthResponse.json();
                    log(`âœ… å¥åº·æ£€æŸ¥é€šè¿‡: ${JSON.stringify(healthData)}`, 'success');
                    
                    // æ£€æŸ¥ä¸»é¡µé¢
                    log('ğŸ” æ­£åœ¨æ£€æŸ¥ä¸»é¡µé¢...');
                    const mainResponse = await fetch(SERVER_URL, {
                        method: 'GET',
                        mode: 'cors'
                    });
                    
                    log(`ğŸ“Š ä¸»é¡µé¢å“åº”çŠ¶æ€: ${mainResponse.status} ${mainResponse.statusText}`);
                    
                    if (mainResponse.ok) {
                        log('âœ… ä¸»é¡µé¢è®¿é—®æ­£å¸¸', 'success');
                        updateStatus('server-status', 'âœ… æœåŠ¡å™¨è¿è¡Œæ­£å¸¸', 'success');
                    } else {
                        log(`âŒ ä¸»é¡µé¢è®¿é—®å¤±è´¥: ${mainResponse.status} ${mainResponse.statusText}`, 'error');
                        updateStatus('server-status', 'âŒ ä¸»é¡µé¢è®¿é—®å¤±è´¥', 'error');
                    }
                } else {
                    log(`âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${healthResponse.status} ${healthResponse.statusText}`, 'error');
                    updateStatus('server-status', 'âŒ å¥åº·æ£€æŸ¥å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                log(`ğŸ” é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
                updateStatus('server-status', 'âŒ æœåŠ¡å™¨è¿æ¥å¤±è´¥', 'error');
            }
        }

        async function checkModules() {
            log('å¼€å§‹æ£€æŸ¥åŠŸèƒ½æ¨¡å—...');
            updateStatus('module-status', 'æ­£åœ¨æ£€æŸ¥...', 'info');

            try {
                // æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦åŒ…å«ç…§ç‰‡è¯†åˆ«ç›¸å…³åŠŸèƒ½
                const mainResponse = await fetch(SERVER_URL);
                const mainHtml = await mainResponse.text();
                
                const modules = [
                    { name: 'CameraCapture', pattern: /CameraCapture/ },
                    { name: 'FaceRecognition', pattern: /faceRecognition/ },
                    { name: 'PhotoStorage', pattern: /photoStorage/ },
                    { name: 'CameraTest', pattern: /camera-test/ }
                ];

                let foundModules = 0;
                modules.forEach(module => {
                    if (module.pattern.test(mainHtml)) {
                        log(`âœ… æ‰¾åˆ°æ¨¡å—: ${module.name}`, 'success');
                        foundModules++;
                    } else {
                        log(`âš ï¸ æœªæ‰¾åˆ°æ¨¡å—: ${module.name}`, 'warning');
                    }
                });

                if (foundModules >= 2) {
                    updateStatus('module-status', `âœ… æ‰¾åˆ° ${foundModules} ä¸ªåŠŸèƒ½æ¨¡å—`, 'success');
                } else {
                    updateStatus('module-status', `âš ï¸ ä»…æ‰¾åˆ° ${foundModules} ä¸ªåŠŸèƒ½æ¨¡å—`, 'warning');
                }
            } catch (error) {
                log(`âŒ æ¨¡å—æ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                updateStatus('module-status', 'âŒ æ¨¡å—æ£€æŸ¥å¤±è´¥', 'error');
            }
        }

        async function checkAPIs() {
            log('å¼€å§‹æ£€æŸ¥APIæ¥å£...');
            updateStatus('api-status', 'æ­£åœ¨æ£€æŸ¥...', 'info');

            try {
                // æ£€æŸ¥APIçŠ¶æ€
                log('ğŸ” æ­£åœ¨æ£€æŸ¥APIçŠ¶æ€...');
                const apiResponse = await fetch(`${SERVER_URL}/api/status`, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                log(`ğŸ“Š APIå“åº”çŠ¶æ€: ${apiResponse.status} ${apiResponse.statusText}`);
                
                if (apiResponse.ok) {
                    const apiData = await apiResponse.json();
                    log(`âœ… APIçŠ¶æ€æ­£å¸¸: ${JSON.stringify(apiData)}`, 'success');
                    updateStatus('api-status', 'âœ… APIæ¥å£æ­£å¸¸', 'success');
                } else {
                    log(`âŒ APIçŠ¶æ€æ£€æŸ¥å¤±è´¥: ${apiResponse.status} ${apiResponse.statusText}`, 'error');
                    updateStatus('api-status', 'âŒ APIæ¥å£å¼‚å¸¸', 'error');
                }
            } catch (error) {
                log(`âŒ APIæ£€æŸ¥å¤±è´¥: ${error.message}`, 'error');
                log(`ğŸ” é”™è¯¯è¯¦æƒ…: ${error.stack}`, 'error');
                updateStatus('api-status', 'âŒ APIæ£€æŸ¥å¤±è´¥', 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            log('ğŸš€ ç…§ç‰‡è¯†åˆ«åŠŸèƒ½åŒæ­¥æµ‹è¯•å¼€å§‹');
            log(`ğŸŒ ç›®æ ‡æœåŠ¡å™¨: ${SERVER_URL}`);
            
            setTimeout(() => checkServerStatus(), 500);
            setTimeout(() => checkModules(), 1000);
            setTimeout(() => checkAPIs(), 1500);
        };
    </script>
</body>
</html> 