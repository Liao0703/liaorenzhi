# 🚀 服务器配置命令指南

## 🔍 问题诊断

你现在在服务器的根目录 (`/root/`)，需要进入项目目录。

---

## 📋 **第一步：检查项目目录**

请在服务器上运行以下命令：

```bash
# 检查项目目录是否存在
ls -la /www/wwwroot/learning-platform/

# 如果目录存在，进入项目目录
cd /www/wwwroot/learning-platform

# 检查当前目录内容
ls -la

# 检查是否有关键文件
ls -la server/
ls -la dist/
```

---

## 📦 **第二步：上传文件（如果目录为空）**

如果项目目录不存在或为空，你需要先上传文件：

### 方式1：使用SCP上传（推荐）

**在你的本地电脑上运行：**

```bash
# 上传整个项目（在本地learning-platform目录中执行）
scp -r server/ root@47.109.142.72:/www/wwwroot/learning-platform/
scp -r dist/ root@47.109.142.72:/www/wwwroot/learning-platform/
scp package.json root@47.109.142.72:/www/wwwroot/learning-platform/
scp ecosystem.config.js root@47.109.142.72:/www/wwwroot/learning-platform/
scp .env.example root@47.109.142.72:/www/wwwroot/learning-platform/
```

### 方式2：使用宝塔面板文件管理器

1. 登录宝塔面板
2. 进入文件管理
3. 导航到 `/www/wwwroot/learning-platform/`
4. 上传以下文件/目录：
   - `server/` 整个目录
   - `dist/` 整个目录  
   - `package.json` 文件
   - `ecosystem.config.js` 文件
   - `.env.example` 文件

---

## ⚙️ **第三步：创建环境变量文件**

上传完成后，在服务器上运行：

```bash
# 进入项目目录
cd /www/wwwroot/learning-platform

# 复制环境变量模板
cp .env.example .env

# 编辑环境变量（使用vi编辑器）
vi .env
```

### 🔧 **环境变量配置内容：**

```env
NODE_ENV=production
PORT=3001

# 数据库配置
DB_HOST=localhost
DB_USER=learning_platform
DB_PASSWORD=你的数据库密码
DB_NAME=learning_platform

# JWT配置
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=24h

# Redis配置 (可选)
REDIS_HOST=localhost
REDIS_PORT=6379

# CORS配置
CORS_ORIGIN=http://47.109.142.72,https://47.109.142.72
```

### 📝 **vi编辑器使用方法：**

```bash
# 按 'i' 进入编辑模式
# 修改配置内容
# 按 'Esc' 退出编辑模式
# 输入 ':wq' 保存并退出
```

---

## 🗄️ **第四步：配置数据库**

```bash
# 检查MySQL是否运行
systemctl status mysql

# 登录MySQL创建数据库（如果还没有创建）
mysql -u root -p

# 在MySQL中执行以下命令：
CREATE DATABASE learning_platform;
CREATE USER 'learning_platform'@'localhost' IDENTIFIED BY '你的密码';
GRANT ALL PRIVILEGES ON learning_platform.* TO 'learning_platform'@'localhost';
FLUSH PRIVILEGES;
EXIT;

# 导入数据库结构
mysql -u learning_platform -p learning_platform < server/init.sql
```

---

## 🔧 **第五步：安装依赖和启动**

```bash
# 确保在项目目录中
cd /www/wwwroot/learning-platform

# 安装Node.js依赖
cd server
npm install --production
cd ..

# 设置文件权限
chmod -R 755 .
mkdir -p logs
chmod -R 777 logs server/uploads

# 使用PM2启动（推荐）
pm2 start ecosystem.config.js

# 或者直接启动
node server/app.js
```

---

## ✅ **第六步：验证部署**

```bash
# 检查进程状态
pm2 status

# 检查端口是否监听
netstat -tlnp | grep 3001

# 测试API
curl http://localhost:3001/health

# 测试外部访问
curl http://47.109.142.72/health
```

---

## 🚨 **快速创建.env（紧急情况）**

如果你急需创建.env文件，可以直接运行：

```bash
cd /www/wwwroot/learning-platform

cat > .env << 'EOF'
NODE_ENV=production
PORT=3001

# 数据库配置
DB_HOST=localhost
DB_USER=learning_platform
DB_PASSWORD=请设置你的数据库密码
DB_NAME=learning_platform

# JWT配置
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=24h

# CORS配置
CORS_ORIGIN=http://47.109.142.72,https://47.109.142.72
EOF

# 然后编辑数据库密码
vi .env
```

---

## 📞 **常见问题解决**

### 问题1：目录不存在
```bash
# 创建项目目录
mkdir -p /www/wwwroot/learning-platform
chown -R www:www /www/wwwroot/learning-platform
```

### 问题2：权限问题
```bash
# 设置正确的文件所有者和权限
chown -R www:www /www/wwwroot/learning-platform
chmod -R 755 /www/wwwroot/learning-platform
```

### 问题3：端口被占用
```bash
# 查看占用端口3001的进程
lsof -i :3001
# 杀死占用的进程
kill -9 PID号
```

---

## 🎯 **下一步**

完成以上步骤后：
1. 在宝塔面板启动Node项目
2. 配置Nginx反向代理
3. 访问 http://47.109.142.72 测试网站

需要帮助时请告诉我你在哪一步遇到了问题！
