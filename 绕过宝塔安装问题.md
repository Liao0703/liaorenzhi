# ç»•è¿‡å®å¡”ä¾èµ–å®‰è£…é—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜åˆ†æ

å®å¡”é¢æ¿æ˜¾ç¤º"é¡¹ç›®ä¾èµ–å®‰è£…å¼‚å¸¸"æ˜¯å› ä¸ºï¼š
- å®å¡”å°è¯•åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬å‰ç«¯ï¼‰
- å‰ç«¯åŒ…å« rollup åŸç”Ÿæ¨¡å—ï¼Œåœ¨æœåŠ¡å™¨ç¯å¢ƒä¸‹å®‰è£…å¤±è´¥
- å®å¡”çš„ Node.js é¡¹ç›®ç®¡ç†æœºåˆ¶æœ‰å±€é™æ€§

## å®Œæ•´è§£å†³æ–¹æ¡ˆ

### ğŸš« åœæ­¢ä½¿ç”¨å®å¡” Node.js é¡¹ç›®ç®¡ç†

**é‡è¦ï¼šä¸è¦å†ä½¿ç”¨å®å¡”çš„ Node.js é¡¹ç›®ç®¡ç†åŠŸèƒ½ï¼**

### âœ… æ”¹ç”¨æ‰‹åŠ¨éƒ¨ç½²æ–¹å¼

#### æ­¥éª¤1ï¼šæ¸…ç†å®å¡”é…ç½®

1. **åˆ é™¤ç°æœ‰ Node.js é¡¹ç›®**
   - å®å¡”é¢æ¿ â†’ Node.js â†’ åˆ é™¤é¡¹ç›®
   
2. **åˆ é™¤å†²çªç½‘ç«™**ï¼ˆå¦‚æœæœ‰ï¼‰
   - ç½‘ç«™ç®¡ç† â†’ åˆ é™¤ç›¸å…³åŸŸåé…ç½®

#### æ­¥éª¤2ï¼šæ‰‹åŠ¨å®‰è£…åç«¯æœåŠ¡

```bash
# SSH è¿æ¥åˆ°æœåŠ¡å™¨åæ‰§è¡Œï¼š

# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/116.62.65.246/learning-platform

# å½»åº•æ¸…ç†ä¾èµ–
rm -rf node_modules package-lock.json

# è¿›å…¥åç«¯ç›®å½•
cd server

# æ¸…ç†åç«¯ä¾èµ–
rm -rf node_modules package-lock.json

# æ£€æŸ¥ package.json
cat package.json

# å®‰è£…åç«¯ä¾èµ–ï¼ˆåªå®‰è£…ç”Ÿäº§ç¯å¢ƒä¾èµ–ï¼‰
npm cache clean --force
npm install --production --no-optional --registry https://registry.npmmirror.com

# éªŒè¯å®‰è£…
node -e "console.log('Node.js works!')"
npm list --depth=0

# æµ‹è¯•åç«¯å¯åŠ¨
node app.js &
sleep 5
kill %1

# ä½¿ç”¨ PM2 æ­£å¼å¯åŠ¨
pm2 start app.js --name learning-platform-server
pm2 save
pm2 startup

# æ£€æŸ¥çŠ¶æ€
pm2 status
pm2 logs learning-platform-server --lines 20
```

#### æ­¥éª¤3ï¼šé…ç½®ç½‘ç«™è®¿é—®

**æ–¹å¼Aï¼šç›´æ¥è®¿é—®åç«¯ï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰**
- è®¿é—®ï¼š`http://116.62.65.246:3001`

**æ–¹å¼Bï¼šé…ç½® Nginx ä»£ç†ï¼ˆæ¨èï¼‰**

1. **åˆ›å»ºç½‘ç«™**ï¼š
   ```
   åŸŸå: 116.62.65.246
   ç«¯å£: 80
   ç½‘ç«™ç›®å½•: /www/wwwroot/116.62.65.246/html
   ```

2. **é…ç½® Nginx**ï¼š
   ```nginx
   # åœ¨ç½‘ç«™è®¾ç½® â†’ é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼š
   
   location / {
       proxy_pass http://127.0.0.1:3001;
       proxy_set_header Host $host;
       proxy_set_header X-Real-IP $remote_addr;
       proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
       proxy_set_header X-Forwarded-Proto $scheme;
   }
   ```

#### æ­¥éª¤4ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep 3001

# æµ‹è¯• API å“åº”
curl http://localhost:3001/
curl http://127.0.0.1:3001/api/health

# æ£€æŸ¥æ—¥å¿—
pm2 logs learning-platform-server
```

### ğŸ”§ æ•…éšœæ’é™¤

#### å¦‚æœ npm install å¤±è´¥ï¼š

```bash
# å°è¯•ä¸åŒçš„ registry
npm install --production --registry https://registry.npmmirror.com

# æˆ–ä½¿ç”¨ cnpm
npm install -g cnpm --registry https://registry.npmmirror.com
cnpm install --production
```

#### å¦‚æœç«¯å£è¢«å ç”¨ï¼š

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3001
netstat -tlnp | grep 3001

# ä¿®æ”¹ç«¯å£ï¼ˆåœ¨ server/app.js ä¸­ï¼‰
# å°† PORT æ”¹ä¸ºå…¶ä»–å€¼ï¼Œå¦‚ 3002
```

#### å¦‚æœ PM2 å¯åŠ¨å¤±è´¥ï¼š

```bash
# æ£€æŸ¥ PM2 çŠ¶æ€
pm2 list

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs learning-platform-server --err

# é‡æ–°å¯åŠ¨
pm2 restart learning-platform-server
```

### ğŸ¯ æœ€ç»ˆé…ç½®

æˆåŠŸåä½ å°†æ‹¥æœ‰ï¼š
- âœ… åç«¯ API æœåŠ¡è¿è¡Œåœ¨ 3001 ç«¯å£
- âœ… PM2 ç®¡ç†è¿›ç¨‹ï¼Œå¼€æœºè‡ªå¯
- âœ… Nginx ä»£ç†ï¼Œé€šè¿‡ 80 ç«¯å£è®¿é—®
- âœ… å®Œå…¨ç»•è¿‡å®å¡”çš„ä¾èµ–ç®¡ç†é—®é¢˜

### ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä¸è¦**å†ä½¿ç”¨å®å¡”çš„ Node.js é¡¹ç›®ç®¡ç†
2. **åªè¿è¡Œ**åç«¯æœåŠ¡ï¼Œå‰ç«¯å•ç‹¬éƒ¨ç½²
3. **ä½¿ç”¨ PM2** ç®¡ç†è¿›ç¨‹ï¼Œä¸ä¾èµ–å®å¡”
4. **å®šæœŸå¤‡ä»½** PM2 é…ç½®ï¼š`pm2 save`

### ğŸš€ åç»­éƒ¨ç½²å‰ç«¯

å¦‚éœ€éƒ¨ç½²å‰ç«¯ï¼š
1. æœ¬åœ°æ‰§è¡Œ `npm run build` ç”Ÿæˆ `dist` æ–‡ä»¶å¤¹
2. ä¸Šä¼  `dist` åˆ°æœåŠ¡å™¨
3. é…ç½® Nginx æŒ‡å‘ `dist` ç›®å½•
